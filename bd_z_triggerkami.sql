CREATE TABLE linia_lotnicza(
nr_linii INTEGER 
	GENERATED BY DEFAULT AS IDENTITY
	PRIMARY KEY,
nazwa VARCHAR(40) NOT NULL
);

CREATE TABLE samolot(
id_samolotu INTEGER PRIMARY KEY,
nr_linii_lotniczej INTEGER
	REFERENCES linia_lotnicza(nr_linii)
		ON UPDATE CASCADE
		ON DELETE RESTRICT,
model VARCHAR(20) NOT NULL,
ile_pasazerow INTEGER NOT NULL,
aktywny BOOL DEFAULT TRUE 
);

CREATE TABLE lotnisko(
    id_lotniska INTEGER PRIMARY KEY,
    kraj VARCHAR(40) NOT NULL,
    miasto VARCHAR(40) NOT NULL
);

CREATE TABLE pilot(
id_pilota INTEGER
	GENERATED BY DEFAULT AS IDENTITY
	PRIMARY KEY,
imie VARCHAR(20) NOT NULL,
nazwisko VARCHAR(40) NOT NULL,
waznosc_uprawnien DATE NOT NULL
	CHECK(waznosc_uprawnien > CURRENT_TIMESTAMP),
aktywny BOOL DEFAULT TRUE
);

CREATE TABLE status(
id_statusu INTEGER GENERATED BY DEFAULT AS IDENTITY
	PRIMARY KEY,
nazwa VARCHAR(20) NOT NULL);

CREATE TABLE rodzaj_bagazu(
id_rodzaju INTEGER
	GENERATED BY DEFAULT AS IDENTITY
	PRIMARY KEY,
nazwa VARCHAR(30) NOT NULL,
maksymalna_waga_kg INTEGER NOT NULL
	CHECK(maksymalna_waga_kg > 0),
maksymalny_rozmiar_cm VARCHAR(30) NOT NULL
);

CREATE TABLE pasazer(
id_pasazera INTEGER
	GENERATED BY DEFAULT AS IDENTITY
	PRIMARY KEY,
imie VARCHAR(20) NOT NULL,
nazwisko VARCHAR(40) NOT NULL,
telefon INTEGER UNIQUE NOT NULL
);

CREATE TABLE loty(
id_lotu INTEGER 
    GENERATED BY DEFAULT AS IDENTITY
	PRIMARY KEY,
data_lotu DATE NOT NULL,
godzina_lotu TIME NOT NULL,
id_lotniska INTEGER NOT NULL REFERENCES lotnisko(id_lotniska) ON UPDATE CASCADE ON DELETE RESTRICT, -- 1
nr_stanowiska INTEGER NOT NULL, -- 2
id_samolotu INTEGER NOT NULL REFERENCES samolot(id_samolotu) ON UPDATE CASCADE ON DELETE RESTRICT, -- 3
id_pilot_1 INTEGER REFERENCES pilot(id_pilota) ON UPDATE CASCADE ON DELETE RESTRICT, -- 4
odlot BOOL DEFAULT TRUE,
id_statusu INTEGER DEFAULT 1 REFERENCES status(id_statusu) ON UPDATE CASCADE ON DELETE RESTRICT, -- 5
opoznienie TIME DEFAULT NULL
);

CREATE TABLE bilet(
id_biletu INTEGER
	GENERATED BY DEFAULT AS IDENTITY
	PRIMARY KEY,
id_pasazera INTEGER
	REFERENCES pasazer(id_pasazera)
		ON UPDATE CASCADE
		ON DELETE RESTRICT,
id_lotu INTEGER
	REFERENCES loty(id_lotu)
		ON UPDATE CASCADE
		ON DELETE RESTRICT
);

CREATE TABLE bagaz(
id_bagazu INTEGER
	GENERATED BY DEFAULT AS IDENTITY
	PRIMARY KEY,
id_rodzaju INTEGER
	REFERENCES rodzaj_bagazu(id_rodzaju)
		ON UPDATE CASCADE
		ON DELETE RESTRICT,
id_biletu INTEGER
	REFERENCES bilet(id_biletu)
		ON UPDATE CASCADE
		ON DELETE CASCADE
);

CREATE OR REPLACE FUNCTION spr_nr_stanowiska() RETURNS TRIGGER AS $$
    BEGIN 
        IF ((SELECT s.aktywny FROM samolot s WHERE s.id_samolotu=NEW.id_samolotu)=FALSE)
        THEN RAISE EXCEPTION 'Samolot o id % nie jest aktywny', NEW.id_samolotu;
        END IF;
        IF ((SELECT p.aktywny FROM pilot p WHERE p.id_pilota=NEW.id_pilot_1)=FALSE)
        THEN RAISE EXCEPTION 'Pilot o id % nie jest aktywny', NEW.id_pilot_1;
        END IF;
        IF (NEW.nr_stanowiska < 1 OR NEW.nr_stanowiska> 6)
            THEN RAISE EXCEPTION 'Stanowisko o numerze % nie istnieje.', NEW.nr_stanowiska;
        END IF;
        IF (NEW.nr_stanowiska= (SELECT nr_stanowiska FROM loty WHERE data_lotu=NEW.data_lotu AND (godzina_lotu <= NEW.godzina_lotu + '00:20:00' AND godzina_lotu >= NEW.godzina_lotu) AND NEW.nr_stanowiska=nr_stanowiska))
            THEN RAISE EXCEPTION 'Stanowisko % w dniu % i godzinie % jest juz zajete.', NEW.nr_stanowiska, NEW.data_lotu, NEW.godzina_lotu; 
        END IF;
        RETURN NEW;
        END;
$$ LANGUAGE 'plpgsql';

CREATE TRIGGER ok_samolot BEFORE UPDATE OR INSERT ON loty FOR EACH ROW EXECUTE PROCEDURE spr_nr_stanowiska();


CREATE OR REPLACE FUNCTION aktywny_samolot() RETURNS TRIGGER AS $$
    BEGIN
    IF NEW.aktywny=FALSE AND EXISTS (SELECT l.id_statusu FROM loty l JOIN samolot s USING(id_samolotu) WHERE l.id_samolotu=OLD.id_samolotu AND (l.id_statusu!=8 OR l.id_statusu !=6))
    THEN RAISE EXCEPTION 'Nie mozna dezaktywowac samolotu - ma juz zaplanowane loty';
    END IF;
    RETURN NEW;
    END;
$$ LANGUAGE 'plpgsql';

CREATE TRIGGER ok_aktywnosc BEFORE UPDATE ON samolot FOR EACH ROW EXECUTE PROCEDURE aktywny_samolot();

CREATE OR REPLACE FUNCTION aktywny_pilot() RETURNS TRIGGER AS $$
    BEGIN
    IF NEW.aktywny=FALSE AND EXISTS (SELECT l.id_statusu FROM loty l JOIN pilot p ON(id_pilota=id_pilot_1) WHERE l.id_pilot_1 = OLD.id_pilota AND (l.id_statusu!=8 OR l.id_statusu !=6))
    THEN RAISE EXCEPTION 'Nie mozna dezaktywowac pilota - ma juz zaplanowane loty';
    END IF;
    RETURN NEW;
    END;
$$ LANGUAGE 'plpgsql';

CREATE TRIGGER ok_aktywnosc_pilota BEFORE UPDATE ON pilot FOR EACH ROW EXECUTE PROCEDURE aktywny_pilot();

CREATE OR REPLACE FUNCTION wolny_samolot(data_l DATE,godz_l TIME) RETURNS TABLE(wolny_samolot INTEGER) AS $$
BEGIN
    RETURN QUERY SELECT s.id_samolotu
    FROM samolot s LEFT OUTER JOIN loty l USING(id_samolotu)
        WHERE (l.id_lotu IS NULL OR (godzina_lotu > godz_l + '00:20:00' AND godzina_lotu < godz_l AND data_l=data_lotu) AND s.aktywny=TRUE);
END;
$$ LANGUAGE 'plpgsql';

CREATE RULE nie_usuwac_lotu AS ON DELETE TO loty DO INSTEAD NOTHING;

CREATE OR REPLACE FUNCTION spr_pelnosc_samolotu() RETURNS TRIGGER AS $$
    DECLARE 
    ile_p INTEGER;
    BEGIN 
        SELECT count(id_lotu) INTO ile_p FROM bilet WHERE id_lotu=NEW.id_lotu GROUP BY id_lotu;
        IF (ile_p = (SELECT s.ile_pasazerow FROM samolot s JOIN loty l USING(id_samolotu) WHERE id_lotu=NEW.id_lotu))
        THEN RAISE EXCEPTION 'Samolot przypisany do lotu % jest juz pelny - nie mozna dodac nowych pasazerow', NEW.id_lotu;
        END IF;
        RETURN NEW;
    END;
$$ LANGUAGE 'plpgsql';

CREATE TRIGGER ok_pelnosc_samolotu BEFORE UPDATE OR INSERT ON bilet FOR EACH ROW EXECUTE PROCEDURE spr_pelnosc_samolotu();

CREATE OR REPLACE FUNCTION czy_podano_opoznienie() RETURNS TRIGGER AS $$
BEGIN
	IF ((SELECT s.nazwa FROM status s WHERE s.id_statusu = NEW.id_statusu) = 'Opóźniony' AND NEW.opoznienie IS NULL)
	THEN RAISE EXCEPTION 'Nie podano opoznienia.';
	END IF;
	RETURN NEW;
END;
$$ LANGUAGE 'plpgsql';

CREATE TRIGGER podano_opoznienie BEFORE UPDATE OR INSERT ON loty
FOR EACH ROW EXECUTE PROCEDURE czy_podano_opoznienie();

CREATE OR REPLACE FUNCTION sprawdz_lot() RETURNS TRIGGER AS $$
BEGIN
	IF((SELECT s.aktywny FROM samolot s WHERE s.id_samolotu=NEW.id_samolotu) = 0)
	THEN RAISE EXCEPTION 'Podany samolot ma status nieaktywny';
	END IF;
	IF((SELECT p.aktywny FROM pilot WHERE p.id_pilota=NEW.id_pilot_1) = 0)
	THEN RAISE EXCEPTION 'Podany pilot ma status nieaktywny';
	END IF;
END;
$$ LANGUAGE 'plpgsql';

CREATE OR REPLACE TRIGGER ok_lot BEFORE INSERT OR UPDATE ON loty FOR EACH ROW EXECUTE PROCEDURE sprawdz_lot();

CREATE OR REPLACE FUNCTION add_or_update_lot(
    id_lotu INTEGER,
    data_lotu DATE,
    godzina_lotu TIME,
    id_lotniska INTEGER,
    nr_stanowiska INTEGER,
    id_samolotu INTEGER,
    id_pilot_1 INTEGER,
    odlot BOOL,
    id_statusu INTEGER,
    opoznienie TIME
) RETURNS VOID AS $$
BEGIN
    IF id_lotu IN (SELECT l.id_lotu FROM loty l) THEN
        UPDATE loty SET
            data_lotu = data_lotu,
            godzina_lotu = godzina_lotu,
            id_lotniska = id_lotniska,
            nr_stanowiska = nr_stanowiska,
            id_samolotu = id_samolotu,
            id_pilot_1 = id_pilot_1,
            odlot = odlot,
            id_statusu = id_statusu,
            opoznienie = opoznienie
        WHERE id_lotu = id_lotu;
    ELSE
        INSERT INTO loty (id_lotu, data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, odlot, id_statusu, opoznienie)
        VALUES (id_lotu, data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, odlot, id_statusu, opoznienie);
    END IF;
END;
$$ LANGUAGE 'plpgsql';

INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (1, 'Wielka Brytania', 'Londyn');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (2, 'Stany Zjednoczone Ameryki', 'Waszyngton');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (3, 'Dania', 'Kopenhaga');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (4, 'Japonia', 'Tokio');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (5, 'Korea Południowa', 'Seul');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (6, 'Australia', 'Sydney');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (7, 'Brazylia', 'Rio De Janeiro');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (8, 'Polska', 'Warszawa');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (9, 'Niemcy', 'Berlin');
INSERT INTO lotnisko (id_lotniska, kraj, miasto) VALUES (10, 'Japonia', 'Osaka');


INSERT INTO linia_lotnicza(nazwa) VALUES ('Polskie Linie lotnicze LOT');
INSERT INTO linia_lotnicza(nazwa) VALUES ('WizzAir');
INSERT INTO linia_lotnicza(nazwa) VALUES ('Ryanair');
INSERT INTO linia_lotnicza(nazwa) VALUES ('Emirates');
INSERT INTO linia_lotnicza(nazwa) VALUES ('Lufthansa');
INSERT INTO linia_lotnicza(nazwa) VALUES ('KLM');


INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (2137, 1, 'Airbus A380', 10);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (4561, 1, 'Airbus A380', 471);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (1111, 1, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (7451, 1, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (3453, 1, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (1234, 2, 'Airbus A380', 471);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (0230, 2, 'Airbus A380', 471);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (2301, 2, 'Airbus A380', 471);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (8439, 3, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (2094, 3, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (0999, 3, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (1723, 3, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (1762, 3, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (1023, 4, 'Airbus A350', 350);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (7561, 4, 'Airbus A350', 350);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (9234, 5, 'Airbus A380', 471);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (8810, 5, 'Airbus A380', 471);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (7071, 5, 'Boeing 747', 452);
INSERT INTO samolot(id_samolotu, nr_linii_lotniczej, model, ile_pasazerow) VALUES (0012, 5, 'Boeing 747', 452);


INSERT INTO status(nazwa) VALUES ('Planowy');
INSERT INTO status(nazwa) VALUES ('Oczekiwany');
INSERT INTO status(nazwa) VALUES ('Opóźniony');
INSERT INTO status(nazwa) VALUES ('Boarding');
INSERT INTO status(nazwa) VALUES ('Odprawa');
INSERT INTO status(nazwa) VALUES ('Odwołany');
INSERT INTO status(nazwa) VALUES ('Wystartował');
INSERT INTO status(nazwa) VALUES ('Wylądował');


INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Leopold', 'Olek', '2035-06-13');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Jan', 'Paweł', '2036-12-07');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Kornel', 'Stąpor', '2026-01-07');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Jakub', 'Dydo', '2025-01-01');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Tobiasz', 'Tyrakowski', '2030-02-07');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Borys', 'Kaliciak', '2031-10-10');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Włodzimierz', 'Syska', '2032-07-13');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Rafał', 'Ograbek', '2029-03-12');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Tymon', 'Latocha', '2029-03-12');
INSERT INTO pilot(imie, nazwisko, waznosc_uprawnien) VALUES ('Karol', 'Rychlicki', '2033-07-13');


INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Karina', 'Teodorczyk', 109024555);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Zuzanna', 'Jaskółka', 155809119);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Lech', 'Ferenc', 755102391);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Bartłomiej', 'Gaj', 733281278);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Mateusz', 'Mentzen', 800137853);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Mariusz', 'Synak', 333078209);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Sylwester', 'Gądek', 858480808);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Feliks', 'Dudziak', 566411563);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Zuzanna', 'Cybul', 510759947);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Sylwester', 'Duda', 853270660);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Kacper', 'Kunysz', 617778499);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Sylwester', 'Gaj', 738220111);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Zuzanna', 'Okołotowicz', 249528637);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Karina', 'Białas', 180507721);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Adam', 'Cybul', 640795290);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Natalia', 'Gawron', 281454077);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Sylwester', 'Okołotowicz', 810133431);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Natalia', 'Nowak', 502902971);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Lech', 'Mentzen', 300824252);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Joanna', 'Ogórek', 714459079);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Laura', 'Pita', 896521940);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Lech', 'Ogórek', 610237346);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Adam', 'Gawron', 864714050);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Kacper', 'Dudziak', 821872226);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Ewa', 'Jaskółka', 400302907);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Eliza', 'Nowak', 780141588);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Michał', 'Ferenc', 997119361);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Kacper', 'Waś', 355004540);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Natalia', 'Gądek', 885459573);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Karina', 'Markiel', 911064839);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Karina', 'Zimoń', 304832083);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Karina', 'Dudziak', 335421592);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Michał', 'Ferenc', 998526613);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Lech', 'Cybul', 181778971);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Bartłomiej', 'Cybul', 488033574);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Natalia', 'Duda', 285181860);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Sylwester', 'Teodorczyk', 774718729);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Kacper', 'Ferenc', 272603937);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Michał', 'Gądek', 105517830);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Eliza', 'Gądek', 862024097);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Mateusz', 'Ogórek', 289268723);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Katarzyna', 'Synak', 987178748);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Aneta', 'Gawron', 204290045);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Ignacy', 'Teodorczyk', 632268516);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Zuzanna', 'Gawron', 111844754);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Dariusz', 'Teodorczyk', 567187097);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Karina', 'Gaj', 704114248);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Kacper', 'Cybul', 121811148);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Feliks', 'Waś', 446445695);
 INSERT INTO pasazer(imie, nazwisko, telefon) VALUES ('Lech', 'Pita', 435375582);


INSERT INTO rodzaj_bagazu(nazwa, maksymalna_waga_kg, maksymalny_rozmiar_cm) VALUES ('kabinowy', 10, '40 x 30 x 20');
INSERT INTO rodzaj_bagazu(nazwa, maksymalna_waga_kg, maksymalny_rozmiar_cm) VALUES ('rejestrowany', 20, '150 x 120 x 170');


INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-02-03', '14:30:00', 4, 1, 2137, 2, 1);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu, opoznienie) VALUES ('2024-01-29', '17:10:00', 2, 2, 2137, 8, 3, '00:30:00');
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-01-29', '15:15:00', 8, 1, 1023, 5, 4);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-01-27', '16:00:00', 7, 6, 0230, 4, 8);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-01-29', '12:30:00', 5, 3, 0012, 10, 6);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-02-18', '00:45:00', 1, 4, 0999, 10, 1);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-03-29', '02:30:00', 2, 3, 2094, 1, 1);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-01-29', '12:30:00', 6, 5, 7071, 3, 7);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-01-30', '19:25:00', 9, 2, 2301, 10, 1);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-02-14', '12:30:00', 5, 6, 8810, 2, 1);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, odlot, id_statusu) VALUES ('2024-01-29', '8:30:00', 3, 2, 1023, 5, FALSE, 8);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, odlot, id_statusu) VALUES ('2024-02-16', '19:25:00', 5, 3, 8810, 2, FALSE, 1);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, odlot, id_statusu, opoznienie) VALUES ('2024-01-29', '17:30:00', 1, 2, 9234, 9, FALSE, 3, '00:23:00');
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, odlot, id_statusu) VALUES ('2024-02-01', '8:30:00', 2, 4, 2137, 8, FALSE, 8);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, odlot, id_statusu) VALUES ('2024-01-29', '19:11:00', 6, 6, 9234, 4, FALSE, 2);
INSERT INTO loty(data_lotu, godzina_lotu, id_lotniska, nr_stanowiska, id_samolotu, id_pilot_1, id_statusu) VALUES ('2024-03-01', '18:20:00', 10, 6, 1023, 4, 1);


INSERT INTO bilet(id_pasazera, id_lotu) VALUES (44, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (35, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (30, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (21, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (32, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (39, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (12, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (37, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (34, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (31, 1);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (13, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (4, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (36, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (24, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (25, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (23, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (6, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (3, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (2, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (20, 2);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (7, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (9, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (15, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (48, 10);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (50, 10);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (11, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (22, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (49, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (17, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (46, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (1, 3);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (5, 4);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (8, 5);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (10, 6);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (14, 8);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (16, 9);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (18, 10);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (19, 3);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (26, 4);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (27, 5);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (28, 6);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (29, 8);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (33, 9);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (38, 10);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (40, 3);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (41, 4);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (42, 5);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (43, 6);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (45, 8);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (47, 10);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (48, 12);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (34, 11);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (41, 11);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (26, 11);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (49, 12);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (16, 12);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (30, 12);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (50, 12);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (28, 11);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (39, 11);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (13, 13);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (36, 13);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (18, 12);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (10, 4);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (5, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (33, 14);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (20, 12);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (32, 15);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (38, 15);
 INSERT INTO bilet(id_pasazera, id_lotu) VALUES (37, 15);


INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 1);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 2);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 3);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 4);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 5);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 6);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 7);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 8);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 9);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 10);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 11);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 12);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 13);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 14);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 15);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 16);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 17);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 18);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 19);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 20);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 21);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 22);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 23);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 24);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 25);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 26);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 27);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 28);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 29);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 30);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 31);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 32);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 33);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 34);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 35);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 36);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 37);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 38);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 39);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 40);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 41);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 42);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 43);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 44);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 45);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 46);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 47);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 48);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 49);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 50);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 51);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 52);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 53);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 54);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 55);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 56);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 57);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 58);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 59);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 60);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 61);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 62);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 63);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 64);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 65);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 66);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 67);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 68);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 69);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 70);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 62);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 49);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 16);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 40);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 67);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 19);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 3);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 66);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 35);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 52);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 8);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 25);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 61);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 65);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 60);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 41);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 11);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 6);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 48);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 12);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 69);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 2);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 70);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 31);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 43);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 42);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 51);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 13);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (2, 37);
 INSERT INTO bagaz(id_rodzaju, id_biletu) VALUES (1, 55);
 
 
CREATE VIEW zajete_miejsca AS SELECT l.id_lotu, count(b.id_lotu) AS zajete_miejsca FROM bilet b RIGHT JOIN loty l USING(id_lotu) GROUP BY l.id_lotu ORDER BY id_lotu;

CREATE VIEW ile_wolnych_miejsc AS SELECT l.id_lotu, l.data_lotu, l.godzina_lotu, k.kraj, k.miasto, s.ile_pasazerow - m.zajete_miejsca AS wolne_miejsca FROM samolot s JOIN loty l USING(id_samolotu) JOIN zajete_miejsca m USING(id_lotu) JOIN lotnisko k USING(id_lotniska);
